<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>اطلب فني</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>

  <body class="font-sans bg-gray-50 text-gray-800 flex flex-col min-h-screen">
    <%- include('../layouts/header') %>

    <!-- Hero Section -->
    <section class="relative w-full h-[400px]">
      <img
        src="/images/hero.png"
        alt="hero"
        class="w-full h-full object-cover absolute inset-0 z-0"
      />

      <div class="relative z-20 flex flex-col justify-center text-white h-full px-20">
        <h1 class="text-5xl font-bold mb-5">أعثر علي الفني المناسب لك</h1>
        <p class="text-lg mb-6 max-w-2xl">
          استكشف أفضل العمال المهرة بسهولة وسرعة، سواء كنت تبحث عن نجار،
          كهربائي، سباك، أو أي خدمة أخرى — كل ما تحتاجه في مكان واحد
        </p>
      </div>

      <!-- Search Form -->
      <form
        class="absolute left-1/2 transform -translate-x-1/2 bottom-[-50px] z-30 bg-white shadow-lg rounded-lg py-4 flex flex-col md:flex-row items-center justify-center gap-4 w-[80%] max-w-4xl"
        onsubmit="event.preventDefault(); alert('ميزة البحث غير مفعّلة حاليًا')"
      >
        <div class="flex items-center w-full md:w-1/3 border border-gray-300 rounded-md p-3 gap-2">
          <i class="fa-solid fa-user text-gray-500"></i>
          <select class="w-full outline-none">
            <option value="">اختر نوع الفني</option>
            <option>نجار</option>
            <option>كهربائي</option>
            <option>سباك</option>
          </select>
        </div>

        <div class="flex items-center w-full md:w-1/3 border border-gray-300 rounded-md p-3 gap-2">
          <i class="fa-solid fa-location-dot text-gray-500"></i>
          <select class="w-full outline-none">
            <option value="">اختر الحي</option>
            <option>حي النرجس</option>
            <option>حي الصحافة</option>
            <option>حي الشفا</option>
          </select>
        </div>

        <button
          type="submit"
          class="w-full md:w-auto bg-gradient-to-r from-orange-400 to-orange-600 hover:from-orange-500 hover:to-orange-700 text-white px-7 py-3 rounded-md shadow-md transition"
        >
          بحث
        </button>
      </form>
    </section>

    <div class="h-24"></div>

    <!-- Filter Buttons -->
    <section class="mt-5 mb-5">
      <div class="flex flex-wrap justify-center gap-4 mb-6">
        <button class="filter-btn px-4 py-2 rounded-lg border border-[#2A4759] text-white hover:bg-[#406A84]  hover:border-[#406A84] active bg-[#2A4759]" data-type="all">
          الكل
        </button>
        <button class="filter-btn px-4 py-2 rounded-lg border border-gray-300 text-[#2A4759] hover:bg-[#406A84] hover:text-white" data-type="نجار">
          فني ألموتال الرياض
        </button>
        <button class="filter-btn px-4 py-2 rounded-lg border border-gray-300 text-[#2A4759] hover:bg-[#406A84] hover:text-white" data-type="كهربائي">
          نجار الرياض
        </button>
      </div>

      <!-- Job Cards -->
      <div id="cards-container" class=" grid md:grid-cols-3 gap-6 px-10">
        <% jobs.forEach(job => { %>
          <div class="card bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm relative">
            <div class="relative h-48">
              <img src="/uploads/jobs/<%= job.jobPhoto %>" alt="<%= job.name %>" class="w-full h-full object-cover" />

              <!-- location icon: Links to /jobs/filter/:jobName -->
              <button 
                class="job-filter-btn group absolute top-2 left-2 bg-white rounded-full p-2 pl-3 pr-3 shadow text-orange-500 flex items-center w-10 hover:w-40 transition-all duration-300 overflow-hidden"
                data-jobname="<%= job.name %>"
              >
                <i class="fa-solid fa-location-dot text-lg  ml-2"></i>
                <span class="ml-2 whitespace-nowrap text-sm text-orange-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                  عرض الأحياء
                </span>
              </button>


            </div>

            <div class="card-body p-4">
              <h3 class="text-lg font-bold text-orange-500 mb-1"><%= job.name %></h3>
              <p class="text-gray-700 text-sm mb-1"><%= job.mainDescription %></p>
              <p class="text-gray-500 text-sm mb-2"><%= job.subDescription %></p>
              <p class="text-sm text-gray-600 mb-2">
                الحي: <%= job.neighborhoodName?.name  %>
              </p>

              <div class="mt-4 flex gap-2">
                <a href="https://wa.me/رقم_الواتساب" target="_blank"
                  class="flex-1 bg-[#2A4759] hover:bg-[#406A84] text-white text-sm text-center py-2 rounded-lg">
                  <i class="fab fa-whatsapp text-2xl pl-2"></i>
                  واتساب
                </a>
                <a href="tel:رقم_الهاتف"
                  class="flex-1 bg-white border border-[#2A4759] hover:bg-[#2A4759] hover:text-white text-[#2A4759] text-sm text-center py-2 rounded-lg">
                  <i class="fa-solid fa-phone text-2xl pl-2"></i>
                  اتصل بنا
                </a>
              </div>
            </div>
          </div>
        <% }) %>
      </div>

      <!-- Load More jobs or nighborhoods -->
      <% if (typeof type !== 'undefined') { %>
        <div class="text-center mt-6">
          <% if (type === 'jobs') { %>
            <a href="/jobs" class="bg-white hover:bg-[#2A4759] hover:text-white text-[#2A4759] border border-[#2A4759] px-6 py-2 rounded-lg shadow-md mb-5 inline-block">
              عرض المزيد >>
            </a>
          <% } else if (type === 'neighborhoods') { %>
            <a href="/allneighborhoods" class="bg-white hover:bg-[#2A4759] hover:text-white text-[#2A4759] border border-[#2A4759] px-6 py-2 rounded-lg shadow-md mb-5 inline-block">
              عرض المزيد >>
            </a>
          <% } %>
        </div>
      <% } %>


      
    </section>

    <%- include('../layouts/footer') %>


   <script>
  document.querySelectorAll(".job-filter-btn").forEach(button => {
    button.addEventListener("click", async function () {
      const jobName = this.dataset.jobname;

      try {
        const response = await fetch(`/jobs/filter/${jobName}`);
        const html = await response.text();

        document.getElementById("cards-container").innerHTML = html;

        const loadMoreContainer = document.querySelector(".text-center.mt-6");
        if (loadMoreContainer) {
          loadMoreContainer.innerHTML = `
            <a href="/allneighborhoods" class="bg-white hover:bg-[#2A4759] hover:text-white text-[#2A4759] border border-[#2A4759] px-6 py-2 rounded-lg shadow-md mb-5 inline-block">
              عرض المزيد >>
            </a>
          `;
        }

      } catch (err) {
        console.error("error", err);
      }
    });
  });
</script>


  </body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl" class="font-[Cairo]">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>كل الأحياء</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body,
    p,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    a,
    button,
    input,
    textarea,
    label,
    div {
      font-family: 'Cairo', sans-serif !important;
    }
  </style>
</head>

<body class="text-gray-800 flex flex-col min-h-screen">

  <!-- header -->
  <%- include("../layouts/header", { searchType: searchType }) %>

    <!-- Breadcrumb -->
    <div class="bg-white mt-5">
      <div class="mx-4 lg:mx-[104px] flex items-center">
        <a href="/" class="text-[#2A4759] hover:text-[#406A84]">
          <i class="fa-solid fa-home text-xl sm:text-2xl ml-2 sm:ml-3"></i>
        </a>

        <i class="fa-solid fa-chevron-left ml-2 sm:ml-3 mr-1 "></i>

        <a href="/technicians" class="font-semibold text-[#2A4759] text-sm sm:text-base hover:text-[#406A84]">
          عرض المزيد
        </a>

        <i class="fa-solid fa-chevron-left ml-2 sm:ml-3  mr-1"></i>

        <a href="/technicians/<%= encodeURIComponent(technician.mainTitle) %>"
          class="font-semibold text-[#2A4759] text-sm sm:text-base hover:text-[#406A84]">
          <%= technician.jobName.name %>
        </a>

        <i class="fa-solid fa-chevron-left ml-2 sm:ml-3  mr-1"></i>

        <span class="font-semibold text-[#B3AFAF] text-sm sm:text-base">عرض الأحياء</span>
      </div>
    </div>

    <!-- Title + Desktop Search -->
    <div class="bg-white py-4">
      <div class="mx-4 lg:mx-[104px] flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
        <div class="text-right lg:text-right">
          <p class="text-[#2A4759] font-bold text-[20px] md:text-[24px] mb-2">
            المناطق التي تتواجد بها خدماتنا
          </p>
          <p class="text-[#2A4759] text-[14px] md:text-[16px]">
            خدماتنا حاليًا متاحة في مناطق متعددة داخل مدينة الرياض، ونسعد بخدمتكم دائمًا
          </p>
        </div>

        <!-- Desktop Search -->
      <form id="search-form" class="hidden lg:flex items-center w-full lg:w-1/3">
  <div class="relative w-full">
    <input type="text" id="search-desktop" placeholder="ابحث عن حي"
      class="w-full border border-gray-300 rounded-[12px] py-2 pr-8 pl-4 focus:outline-none focus:ring-2 focus:ring-[#2A4759]" />
    <button type="submit"
      class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 hover:text-[#2A4759]">
      <i class="fa-solid fa-magnifying-glass"></i>
    </button>
      <ul
      id="autocomplete-list-desktop"
      class="absolute z-10 bg-white border border-gray-200 rounded-lg shadow-md w-full mt-1 max-h-60 overflow-y-auto hidden"
    ></ul>
  </div>
</form>

      </div>
    </div>

    <!-- Cards -->
    <div class="mx-4 lg:mx-[104px] py-8 flex-grow">
      <div id="cards-container" class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <% neighborhoodsWithJobs.forEach(({ neighborhood, job })=> { %>
          <%- include('../partials/neighborhoodCard', { neighborhood, job }) %>
            <% }) %>
      </div>

      <!-- No results -->
      <div id="no-results" class="hidden text-center py-10 text-gray-500">
        <i class="fa-solid fa-circle-exclamation text-3xl mb-3 text-[#2A4759]"></i>
        <p class="text-lg font-semibold">لا يوجد أحياء حسب بحثك</p>
      </div>
    </div>

    <!-- footer -->
    <%- include("../layouts/footer") %>

      <script>
        // Autocomplete function
       function setupAutocomplete(inputId, listId, data) {
  const searchInput = document.getElementById(inputId);
  const suggestionBox = document.getElementById(listId);

  if (searchInput) {
    searchInput.addEventListener('input', () => {
      const val = searchInput.value.toLowerCase();
      suggestionBox.innerHTML = '';
      suggestionBox.classList.add("hidden"); 
      if (!val) return;

      const matches = data.filter(name => name.toLowerCase().includes(val));

      if (matches.length > 0) {
        suggestionBox.classList.remove("hidden"); 
        matches.forEach(name => {
          const li = document.createElement('li');
          li.textContent = name;
          li.className = "px-4 py-2 cursor-pointer hover:bg-gray-100";
          li.addEventListener('click', () => {
            searchInput.value = name;
            suggestionBox.innerHTML = '';
            suggestionBox.classList.add("hidden");
          });
          suggestionBox.appendChild(li);
        });
      }
    });

    document.addEventListener('click', (e) => {
      if (!searchInput.contains(e.target) && !suggestionBox.contains(e.target)) {
        suggestionBox.innerHTML = '';
        suggestionBox.classList.add("hidden");
      }
    });
  }
}

        const neighborhoods = JSON.parse('<%- JSON.stringify(neighborhoodsWithJobs.map(n => n.neighborhood.name)) %>');

        // Desktop search
        setupAutocomplete('search-desktop', 'autocomplete-list-desktop', neighborhoods);

        function handleSearch(inputId) {
          const searchInput = document.getElementById(inputId);
          const noResults = document.getElementById("no-results");
          if (!searchInput) return;

          searchInput.addEventListener("input", function () {
            const query = this.value.toLowerCase();
            let anyVisible = false;

            document.querySelectorAll("#cards-container > div").forEach(card => {
              const name = card.querySelector(".neighborhood-card-title")?.textContent.toLowerCase() || "";
              if (name.includes(query)) {
                card.style.display = "block";
                anyVisible = true;
              } else {
                card.style.display = "none";
              }
            });

            if (!anyVisible) {
              noResults.classList.remove("hidden");
            } else {
              noResults.classList.add("hidden");
            }
          });
        }

    handleSearch("search-desktop");

     const form = document.getElementById("search-form");
  const input = document.getElementById("search-desktop");
  const technicianSlug = "<%= encodeURIComponent(technician.slug) %>";

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const value = input.value.trim();
    if (!value) return;

    const neighborhoodSlug = encodeURIComponent(value.replace(/\s+/g, "-"));
    window.location.href = `/technicians/عرض-الاحياء/${technicianSlug}/${neighborhoodSlug}`;
  });
  </script>

<!-- Floating Contact Buttons -->
<div
  class="fixed right-4 bottom-4 flex flex-col gap-3 z-50"
>
  <!-- Phone -->
  <a
    href="tel:<%= mainPhone %>"
    class="bg-[#2A4759] hover:bg-[#1e3542] text-white p-3 sm:p-4 rounded-full shadow-md shadow-white/30 transition transform hover:scale-110 flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14"
  >
    <i class="fa-solid fa-phone text-base sm:text-lg"></i>
  </a>

  <!-- WhatsApp -->
  <a
    href="https://wa.me/<%= mainPhone %>"
    target="_blank"
    class="bg-green-500 hover:bg-green-600 text-white p-3 sm:p-4 rounded-full  transition transform hover:scale-110 flex items-center justify-center w-12 h-12 sm:w-14 sm:h-14"
  >
    <i class="fab fa-whatsapp text-lg sm:text-xl"></i>
  </a>
</div>
</body>

</html>
<h1>All Blogs</h1>

<a href="/dashboard/blogs/new">Add New Blog</a>
<ul>
    <% blogs.forEach(b=> { %>
        <li>
            <h3>
                <%= b.title %>
            </h3>
            <p>Blog Category: <%= b.blog %>
            </p>
            <div>
                <a href="/dashboard/blogs/<%= b._id %>">View</a>
                <a href="/dashboard/blogs/<%= b._id %>/edit">Edit</a>
                <form action="/dashboard/blogs/<%= b._id %>?_method=DELETE" method="POST" style="display:inline;">
                    <button type="submit" onclick="return confirm('Delete this blog?')">Delete</button>
                </form>
            </div>
        </li>
        <% }) %>
      </tbody>
    </table>

    <!-- رسالة عدم وجود نتائج -->
    <div id="noResults" class="text-center py-8 text-gray-500 hidden">
      <i class="fa-solid fa-search text-4xl mb-4 text-gray-300"></i>
      <p class="text-lg">لا توجد نتائج تطابق البحث.</p>
    </div>
  </div>

  <!-- Delete confirmation modals -->
<% blogs.forEach(n => { %>
  <%- include('../layouts/confirmDelete', {
    modalId: `deleteBlogModal_${n._id}`,
    message: 'هل أنت متأكد من أنك تريد حذف هذه المدونة؟',
    deleteAction: `/dashboard/blogs/${n._id}?_method=DELETE`
  }) %>
<% }) %>
</div>

<script>
  // Blog search functionality
  const searchInput = document.getElementById('blogSearchInput');
  const clearBtn = document.getElementById('clearBlogSearch');
  const allRows = Array.from(document.querySelectorAll('.blog-row'));

  const filterBlogs = () => {
    const term = searchInput.value.toLowerCase().trim();
    let visibleCount = 0;
    allRows.forEach(row => {
      if (row.dataset.title.includes(term)) {
        row.style.display = 'table-row';
        visibleCount++;
      } else {
        row.style.display = 'none';
      }
    });
    document.getElementById('noResults').classList.toggle('hidden', visibleCount > 0);
    document.getElementById('totalBlogs').textContent = visibleCount;
  }

  searchInput.addEventListener('input', filterBlogs);
  clearBtn.addEventListener('click', () => {
    searchInput.value = '';
    filterBlogs();
  });

  document.addEventListener('DOMContentLoaded', filterBlogs);
  // Modal functions
function deleteItem(id) {
  const modal = document.getElementById(`deleteBlogModal_${id}`);
  if (modal) {
    modal.classList.remove('hide');
    modal.style.display = 'flex';
    setTimeout(() => {
      modal.classList.add('show');
    }, 10);
  }
}


function hideModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('show');
    modal.classList.add('hide');
    setTimeout(() => {
      modal.style.display = 'none';
    }, 400);
  }
  }
</script>

RewriteEngine On

# تحويل كل الروابط من www إلى non-www مع https (Canonical دائم)
RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^(.*)$ https://%1/$1 [R=301,L]

# إجبار الوصول عبر https دائماً (Canonical)
RewriteCond %{HTTPS} !=on
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# ضغط الملفات (Gzip)
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html text/plain text/xml application/xml application/xhtml+xml text/css text/javascript application/javascript application/x-javascript
</IfModule>

# تفعيل الكاش للصور والملفات الثابتة
<IfModule mod_expires.c>
ExpiresActive On
ExpiresByType image/jpg "access plus 1 year"
ExpiresByType image/jpeg "access plus 1 year"
ExpiresByType image/gif "access plus 1 year"
ExpiresByType image/png "access plus 1 year"
ExpiresByType text/css "access plus 1 month"
ExpiresByType text/javascript "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"
</IfModule>

# تخصيص صفحة خطأ 404
ErrorDocument 404 /errors/404.html

# منع استعراض محتويات المجلدات
Options -Indexes

# تفعيل HSTS
<IfModule mod_headers.c>
Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
</IfModule>

# إشعار محركات البحث بالسماح بالأرشفة وفرض الكانونيكال
Header set X-Robots-Tag "index, follow"

# دعم sitemap لجوجل والزواحف
<IfModule mod_rewrite.c>
RewriteRule ^sitemap\.xml$ /sitemap.xml [L]
</IfModule>

# منع أرشفة صفحات الخصوصية أو الداخلية فقط
<Files "privacy-policy.html">
Header set X-Robots-Tag "noindex, nofollow"
</Files>

# قاعدة تمنع تكرار الروابط مع / أو بدون / في آخر الرابط (يفضل)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^(.*)/$ /$1 [R=301,L]

# يسمح فقط بالنسخة الموحدة للصفحة ويمنع أي تكرار لأي شكل آخر للرابط
